<!-- ì „ì²´ ë©”ì¸ í˜ì´ì§€ -->
<!DOCTYPE html>
<html style="height:100%;">
  <head>
    <meta charset="utf-8" />
    <title>ë²½ëŒê¹¨ê¸° with Pose</title>
    <link rel="stylesheet" href="../style/style.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose@0.0.7/dist/handpose.min.js"></script>
    <script type="module" src="/js/sketch.js"></script>
  </head>

  <body style="height:100vh; margin:0; position:relative;">
    <div id="canvas-container"
         style="display:flex; justify-content:center; align-items:center; height:100vh; width:100vw; position:relative;">
      <!-- p5.js ìº”ë²„ìŠ¤ê°€ ì—¬ê¸°ì— ë“¤ì–´ê° -->
    </div>
    
    <button id="startBtn"
      style="display:block; position:absolute; font-size:24px; z-index:10;">
      START
    </button>
    <button id="restartBtn"
      style="display:none; position:absolute; font-size:24px; z-index:10;">
      RESTART
    </button>
      <div id="color-select" style="display:none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; padding: 40px; border-radius: 15px; min-width: 400px;">
       
      
      <!-- ìƒ‰ìƒ ì„ íƒ ë²„íŠ¼ë“¤ -->
      <div style="display: flex; flex-direction: column; align-items: center; gap: 20px; margin-bottom: 40px;">
        <button data-color="red" style="width: 50px; height: 50px; top: 10px; background: red; border: 2px solid white; border-radius: 10px; cursor: pointer;" onclick="selectColor(this, 'red')"></button>
        <button data-color="yellow" style="width: 50px; height: 50px; top: 70px; background: yellow; border: 2px solid white; border-radius: 10px; cursor: pointer;" onclick="selectColor(this, 'yellow')"></button>
        <button data-color="green" style="width: 50px; height: 50px; top: 130px; background: green; border: 2px solid white; border-radius: 10px; cursor: pointer;" onclick="selectColor(this, 'green')"></button>
        <button data-color="blue" style="width: 50px; height: 50px; top: 190px; background: blue; border: 2px solid white; border-radius: 10px; cursor: pointer;" onclick="selectColor(this, 'blue')"></button>
        <button data-color="purple" style="width: 50px; height: 50px; top: 250px; background: purple; border: 2px solid white; border-radius: 10px; cursor: pointer;" onclick="selectColor(this, 'purple')"></button>
      </div>
      
      <!-- ì„ íƒ ìƒíƒœ í‘œì‹œ -->
      <div style="display: flex; justify-content: space-between; color: #573016; font-family: 'mango'; font-weight: medium; font-size: 18px; margin-bottom: 30px;">
        <div style="text-align: center;">
          <div style="margin-bottom: 15px;">MEğŸ¯</div>
          <div id="my-selection" style="width: 70px; height: 70px; border: 2px solid white; border-radius: 8px; background: gray; margin: 0 auto;"></div>
        </div>
        <div style="text-align: center;">
          <div style="margin-bottom: 15px;">FRIENDğŸ•¹ï¸</div>
          <div id="opponent-selection" style="width: 70px; height: 70px; border: 2px solid white; border-radius: 8px; background: gray; margin: 0 auto;"></div>
        </div>
      </div>
      
      <!-- ê²Œì„ ì‹œì‘ ë²„íŠ¼ (ì²˜ìŒì—ëŠ” ìˆ¨ê¹€) -->
      <div id="start-game-btn" style="display: none;">
        <button onclick="startGame()" style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        font-family: 'MangoDdobak-B';
        font-size: 22px;
        font-weight: bold;
        width:150px;
        text-align: center;
        padding: 10px 24px;
        border: 2px solid #5a321788;
        border-radius: 18px;
        background: #efcd95;
        color: #5A3217;
        box-shadow: 0 2px 2px #aa918136;
        cursor: pointer;
      "
    >START!</button>
      </div>
    </div>
  
  <script>
    let myColor = null;
    let opponentColor = null;
    
    function selectColor(button, color) {
      // ëª¨ë“  ë²„íŠ¼ì˜ í…Œë‘ë¦¬ë¥¼ í°ìƒ‰ìœ¼ë¡œ ì´ˆê¸°í™”
      const allButtons = document.querySelectorAll('[data-color]');
      allButtons.forEach(btn => {
        btn.style.border = '3px solid white';
      });
      
      // í´ë¦­ëœ ë²„íŠ¼ì˜ í…Œë‘ë¦¬ë¥¼ ê²€ì€ìƒ‰ìœ¼ë¡œ ë³€ê²½
      button.style.border = '2px solid #374151';
      
      // ì„ íƒëœ ìƒ‰ìƒì„ ì €ì¥
      myColor = color;
      window.myPaddleColor = color;
      
      // ë‚´ ì„ íƒ í‘œì‹œ ì—…ë°ì´íŠ¸
      updateMySelection(color);
      
      // ì„œë²„ì— ìƒ‰ìƒ ì„ íƒ ë©”ì‹œì§€ ì „ì†¡
      if (window.socket && window.socket.readyState === WebSocket.OPEN) {
        window.socket.send(JSON.stringify({ type: "select_color", color: color }));
      }
    }
    
    function updateMySelection(color) {
      const mySelection = document.getElementById('my-selection');
      mySelection.style.background = color;
    }
    
    function updateOpponentSelection(color) {
      const opponentSelection = document.getElementById('opponent-selection');
      opponentSelection.style.background = color;
    }
    
    function showStartButton() {
      const startBtn = document.getElementById('start-game-btn');
      startBtn.style.display = 'block';
    }
    
    function startGame() {
      // ê²Œì„ ì‹œì‘ ë©”ì‹œì§€ ì „ì†¡
      if (window.socket && window.socket.readyState === WebSocket.OPEN) {
        window.socket.send(JSON.stringify({ type: "ready_to_start" }));
        console.log("ê²Œì„ ì‹œì‘ ë²„íŠ¼ í´ë¦­ë¨");
      }
    }
    
    // ì „ì—­ í•¨ìˆ˜ë¡œ ì„¤ì • (socket.jsì—ì„œ ì ‘ê·¼ ê°€ëŠ¥)
    window.updateMySelection = updateMySelection;
    window.updateOpponentSelection = updateOpponentSelection;
    window.showStartButton = showStartButton;
  </script>
  </body>
</html>
